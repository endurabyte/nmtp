# nmtp

nmtp is a fork of [LibMtpSharp](https://github.com/shaosss/LibMtpSharp). 
nmtp is a wrapper of [libmtp](https://github.com/libmtp/libmtp) with a few [changes](https://github.com/endurabyte/libmtp)

## Use

See the libmtp documentation at the link above.

To list available MTP devices, create a `RawDeviceList`.

To connect to a device, create a `OpenedMtpDevice`. It contains the methods to communicate with device.

**Don't forget to dispose!**

## Example

```c#
using var list = new RawDeviceList();
foreach(RawDevice device in list)
{
  Console.WriteLine(device);
}

var rawDevice = list.First();
using var device = new Device()
bool isOpen = device.TryOpen(ref rawDevice, cached: true);
if (!isOpen) { return; }

IEnumerable<Nmtp.Folder> folders = device.GetFolderList(storage.Id);
var cameraDir = folders.FirstOrDefault(folder => folder.Name == "Camera"); // e.g. Android Camera directory
if (cameraDir.FolderId <= 0) { return; }

// Get all PNG files from the last 7 days
List<Nmtp.File> files = device
    .GetFiles(progress =>
    {
      Log.Info($"List files progress: {progress * 100:##.#}%");
      return true; // true: keep loading
    })
    .Where(file => file.ParentId == cameraDir.FolderId)
    .Where(file => file.FileName.EndsWith(".png"))
    .Where(file => DateTime.UnixEpoch + TimeSpan.FromSeconds(file.ModificationDate) > DateTime.UtcNow - TimeSpan.FromDays(7))
    .ToList();

List<byte[]> data = files
    .Select((Nmtp.File file) =>
    {
      using var ms = new MemoryStream();
      bool ok = device.GetFile(file.ItemId, progress =>
      {
        Log.Info($"Download progress {file.FileName} {progress * 100:##.#}%");
        return false; // false => continue, true => cancel
      }, ms);

      return ms.ToArray();
    })
    .ToList();
```

## Logo

Logo icon generated by DALL-E 3.
